<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MASESORA - Diagn√≥stico Empresarial</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <style>
    body { background: #f6f6f6; font-family: 'Montserrat', Arial, sans-serif; margin:0; padding:0; }
    .navbar { background-color: #192444; padding:18px 26px; display:flex; align-items:center; }
    .brand-text { color: #cfb258; font-weight:700; font-size:2.2rem; letter-spacing:2px;}
    .intro {
      max-width:820px;
      margin:40px auto 30px;
      font-size:1.15rem;
      text-align:center;
      font-weight:500;
      color:#192444;
      line-height:1.7;
    }
    .intro .highlight { color:#fa8128; font-weight:700; }
    .empresa-box {
      max-width:600px;
      margin:0 auto 25px;
      background:white;
      padding:30px;
      border-radius:12px;
      box-shadow:0 2px 15px rgba(0,0,0,0.08);
    }
    .empresa-box label { 
      font-weight:700; 
      font-size:1.15rem; 
      margin-bottom:8px;
      color:#192444;
      display:block;
    }
    .empresa-box input { 
      font-size:1.15rem; 
      font-weight:600; 
      width:100%;
      border:2px solid #1e4fad; 
      border-radius:8px; 
      padding:12px 20px;
      margin-bottom:20px;
    }
    .section { 
      background:white; 
      border-radius:10px; 
      padding:25px 30px; 
      margin-bottom:20px; 
      box-shadow:0 2px 13px rgba(0,0,0,0.08); 
    }
    .section h4 {
      color:#192444;
      font-weight:700;
      margin-bottom:20px;
      border-bottom:3px solid #cfb258;
      padding-bottom:8px;
    }
    .charts-container {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:30px;
      margin:40px 0;
    }
    @media (max-width: 768px) {
      .charts-container {
        grid-template-columns:1fr;
      }
    }
    .chart-box {
      background:white;
      padding:25px;
      border-radius:12px;
      box-shadow:0 2px 15px rgba(0,0,0,0.08);
    }
    .chart-box h5 {
      text-align:center;
      color:#192444;
      font-weight:700;
      margin-bottom:20px;
    }
    #barChartContainer {
      height:400px;
    }
    #radarChartContainer {
      height:400px;
    }
    .dashboard-title {
      text-align:center;
      font-size:1.8rem;
      font-weight:700;
      color:#192444;
      margin:30px 0 20px 0;
    }
    .especialidad-card {
      padding:20px;
      margin-bottom:15px;
      border-radius:8px;
      background:#fff;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
      border-left:6px solid;
    }
    .especialidad-card.critico { border-left-color:#d90033; }
    .especialidad-card.recomendado { border-left-color:#fa8128; }
    .especialidad-card.optimizador { border-left-color:#21ae52; }
    .especialidad-card.elite { border-left-color:#1e4fad; }
    .especialidad-nombre {
      font-weight:700;
      font-size:1.1rem;
      margin-bottom:8px;
    }
    .especialidad-score {
      font-size:2rem;
      font-weight:700;
      display:inline-block;
      margin-right:15px;
    }
    .especialidad-nivel {
      display:inline-block;
      padding:6px 15px;
      border-radius:20px;
      font-weight:600;
      font-size:0.9rem;
    }
    .presupuesto-box {
      background:white;
      padding:30px;
      border-radius:15px;
      margin:30px 0;
      box-shadow:0 4px 20px rgba(0,0,0,0.1);
      border:3px solid #cfb258;
    }
    .presupuesto-box h3 {
      margin:0 0 25px 0;
      font-size:1.8rem;
      color:#192444;
      text-align:center;
    }
    .presupuesto-categoria {
      margin-bottom:25px;
    }
    .presupuesto-categoria h4 {
      color:#192444;
      font-weight:700;
      font-size:1.2rem;
      margin-bottom:15px;
      padding-bottom:10px;
      border-bottom:2px solid #eee;
    }
    .presupuesto-categoria.critico h4 { border-bottom-color:#d90033; }
    .presupuesto-categoria.recomendado h4 { border-bottom-color:#fa8128; color:#fa8128; }
    .especialidad-presupuesto {
      background:#f8f9fa;
      padding:15px;
      margin-bottom:10px;
      border-radius:8px;
      border-left:4px solid;
    }
    .especialidad-presupuesto.critico { border-left-color:#d90033; }
    .especialidad-presupuesto.recomendado { border-left-color:#fa8128; }
    .esp-nombre-presupuesto {
      font-weight:700;
      font-size:1rem;
      color:#192444;
      margin-bottom:5px;
    }
    .esp-precios {
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
    }
    .precio-item {
      font-size:1.1rem;
      font-weight:600;
    }
    .precio-item span {
      color:#666;
      font-size:0.85rem;
      font-weight:400;
    }
    .descuento-badge {
      background:#21ae52;
      color:white;
      padding:4px 10px;
      border-radius:15px;
      font-size:0.8rem;
      font-weight:700;
    }
    .garantia-box {
      background:linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
      border:3px solid #21ae52;
      border-radius:12px;
      padding:25px;
      margin-top:30px;
    }
    .garantia-box h4 {
      color:#21ae52;
      margin:0 0 15px 0;
      font-size:1.3rem;
      text-align:center;
      font-weight:700;
    }
    .garantia-box .metodologia {
      margin:0 0 10px 0;
      font-weight:700;
      color:#192444;
      font-size:1.05rem;
    }
    .garantia-box ul {
      margin:10px 0 0 0;
      padding-left:25px;
      color:#192444;
      line-height:1.8;
    }
    .garantia-box li {
      margin-bottom:10px;
      font-size:1rem;
    }
    .email-box {
      margin-top:40px;
      text-align:center;
      background:#f0f4ff;
      padding:30px;
      border-radius:12px;
      box-shadow:0 2px 15px rgba(0,0,0,0.08);
    }
    .btn-send {
      font-weight:700; 
      font-size:1.05rem; 
      padding:12px 30px;
      border-radius:10px; 
      margin-top:15px;
      background:#1e4fad;
      border:none;
      transition:.3s;
    }
    .btn-send:hover {
      background:#cfb258;
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(207,178,88,0.4);
    }
    .activation-code {
      font-size:1.3rem;
      letter-spacing:3px;
      font-weight:bold;
      color:#d90033;
      margin-top:20px;
      padding:15px;
      background:#fff;
      border-radius:8px;
      border:2px dashed #cfb258;
    }
    .spinner {
      display:inline-block;
      width:20px;
      height:20px;
      border:3px solid rgba(255,255,255,.3);
      border-radius:50%;
      border-top-color:#fff;
      animation:spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<nav class="navbar">
  <div style="width:60px;height:60px;background:#cfb258;border-radius:7px;margin-right:20px;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;color:#192444;">M</div>
  <div class="brand-text">MASESORA</div>
</nav>

<div class="intro">
  En Masesora, te invitamos a <span class="highlight">reflexionar</span>.<br>
  Sabemos que tu tiempo es oro, y con este sencillo cuestionario y gracias a nuestro equipo te facilitaremos el estado de salud de tu empresa.<br>
  Un descubrimiento real y visual por medio de herramientas pr√°cticas y matrices, que te guiar√°n para que optimices los principales factores productivos de tu empresa.
</div>

<div class="empresa-box">
  <label for="nombreEmpresa">Nombre de la empresa *</label>
  <input type="text" id="nombreEmpresa" placeholder="Ej: Innovaci√≥n SL" required>
  
  <label for="facturacion">Facturaci√≥n mensual aproximada (‚Ç¨) *</label>
  <input type="number" id="facturacion" placeholder="Ej: 15000" min="0" required>
</div>

<div class="container">
  <form id="assessmentForm" class="mb-4 mt-3">
    <!-- RENTABILIDAD -->
    <div class="section">
      <h4>RENTABILIDAD (Finanzas y Estrategia)</h4>
      <label style="font-weight:bold;">¬øSientes que tu empresa realmente tiene el control y claridad sobre d√≥nde est√° tu dinero y c√≥mo hacerlo crecer sosteniblemente?</label>
      <select name="rentabilidad1" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">No tengo control</option>
        <option value="2">Me cuesta entenderlo</option>
        <option value="3">Parcialmente</option>
        <option value="4">Totalmente claro</option>
      </select>
      
      <label style="font-weight:bold;">¬øCon qu√© frecuencia revisas tus resultados financieros para tomar decisiones que eviten p√©rdidas y aprovechen oportunidades?</label>
      <select name="rentabilidad2" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Rara vez</option>
        <option value="3">Mensualmente</option>
        <option value="4">Semanalmente</option>
      </select>
      
      <label style="font-weight:bold;">¬øTu negocio tiene una estrategia clara y compartida que gu√≠a cada movimiento para asegurar rentabilidad futura?</label>
      <select name="rentabilidad3" class="form-select mb-2" required>
        <option value="">Seleccione</option>
        <option value="1">No existe estrategia</option>
        <option value="2">Poco definida</option>
        <option value="3">Algo definida</option>
        <option value="4">S√≠, claramente definida</option>
      </select>
    </div>

    <!-- PROCESOS -->
    <div class="section">
      <h4>PROCESOS (Gesti√≥n, Crisis y Mejora)</h4>
      <label style="font-weight:bold;">¬øLos procesos cr√≠ticos de tu negocio est√°n documentados, actualizados y preparados para enfrentar imprevistos o crisis?</label>
      <select name="procesos1" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Rara vez</option>
        <option value="3">Algunas veces</option>
        <option value="4">Siempre</option>
      </select>
      
      <label style="font-weight:bold;">¬øQu√© tan efectivo es tu sistema para detectar, corregir errores y mejorar procesos que liberan tiempo y recursos?</label>
      <select name="procesos2" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">No existe sistema</option>
        <option value="2">Poco efectivo</option>
        <option value="3">Moderadamente</option>
        <option value="4">Muy efectivo</option>
      </select>
      
      <label style="font-weight:bold;">¬øSientes que los procesos actuales te permiten reaccionar r√°pido y minimizar da√±os cuando enfrentan problemas serios?</label>
      <select name="procesos3" class="form-select mb-2" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Rara vez</option>
        <option value="3">Algunas veces</option>
        <option value="4">S√≠, siempre</option>
      </select>
    </div>

    <!-- TIEMPOS -->
    <div class="section">
      <h4>TIEMPOS (Productividad y Control)</h4>
      <label style="font-weight:bold;">¬øCrees que tu equipo utiliza el tiempo de manera eficiente y productiva, evitando el estr√©s y sobrecarga?</label>
      <select name="tiempo1" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Muy ineficiente</option>
        <option value="2">Poco eficiente</option>
        <option value="3">Regular</option>
        <option value="4">Totalmente eficiente</option>
      </select>
      
      <label style="font-weight:bold;">¬øEst√°n claramente identificados los factores o actividades que consumen tiempo innecesario en tu empresa?</label>
      <select name="tiempo2" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">No se identifican</option>
        <option value="2">Se identifican pero no se solucionan</option>
        <option value="3">Se identifican parcialmente</option>
        <option value="4">S√≠, y se est√°n solucionando</option>
      </select>
      
      <label style="font-weight:bold;">¬øUtilizas herramientas o metodolog√≠as para asegurar que las tareas y proyectos se completen a tiempo?</label>
      <select name="tiempo3" class="form-select mb-2" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Rara vez</option>
        <option value="3">Algunas veces</option>
        <option value="4">S√≠, frecuentemente</option>
      </select>
    </div>

    <!-- PERSONAS -->
    <div class="section">
      <h4>PERSONAS (Equipo y Cultura)</h4>
      <label style="font-weight:bold;">¬øTu equipo est√° motivado, comprometido y entiende claramente su rol en la recuperaci√≥n y crecimiento del negocio?</label>
      <select name="personas1" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Desmotivado</option>
        <option value="2">Poco motivado</option>
        <option value="3">Medianamente</option>
        <option value="4">Muy motivado</option>
      </select>
      
      <label style="font-weight:bold;">¬øSe promueve un ambiente laboral que favorece la colaboraci√≥n, respeto y crecimiento personal?</label>
      <select name="personas2" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Rara vez</option>
        <option value="3">A veces</option>
        <option value="4">Siempre</option>
      </select>
      
      <label style="font-weight:bold;">¬øSientes que cuentas con el talento necesario y que las capacitaciones apoyan su desempe√±o efectivo?</label>
      <select name="personas3" class="form-select mb-2" required>
        <option value="">Seleccione</option>
        <option value="1">No hay</option>
        <option value="2">Poco</option>
        <option value="3">Parcialmente</option>
        <option value="4">Totalmente</option>
      </select>
    </div>

    <!-- COMUNICACI√ìN -->
    <div class="section">
      <h4>COMUNICACI√ìN (Interna y Comercial)</h4>
      <label style="font-weight:bold;">¬øLa comunicaci√≥n interna es transparente, clara y constante, ayudando a que todos remen hacia los mismos objetivos?</label>
      <select name="comunicacion1" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Nunca</option>
        <option value="2">Pocas veces</option>
        <option value="3">A menudo</option>
        <option value="4">Siempre</option>
      </select>
      
      <label style="font-weight:bold;">¬øLas reuniones y canales de comunicaci√≥n est√°n dise√±ados para resolver problemas y avanzar r√°pidamente?</label>
      <select name="comunicacion2" class="form-select mb-3" required>
        <option value="">Seleccione</option>
        <option value="1">Nada</option>
        <option value="2">Poco</option>
        <option value="3">Regular</option>
        <option value="4">Totalmente</option>
      </select>
      
      <label style="font-weight:bold;">¬øLa comunicaci√≥n con tus clientes refleja confianza y fortalece la relaci√≥n para aumentar ventas y fidelizaci√≥n?</label>
      <select name="comunicacion3" class="form-select mb-2" required>
        <option value="">Seleccione</option>
        <option value="1">Inexistente</option>
        <option value="2">D√©bil</option>
        <option value="3">S√≥lida</option>
        <option value="4">Muy s√≥lida</option>
      </select>
    </div>

    <button type="button" class="btn btn-primary btn-lg w-100 mt-3" onclick="generarDiagnostico()">
      ¬°Ver mi diagn√≥stico ahora!
    </button>
  </form>

  <div id="resultSection" style="display:none;">
    <div class="dashboard-title" id="dashboardEmpresa"></div>
    
    <div class="charts-container">
      <div class="chart-box">
        <h5>üìä Puntuaci√≥n por Especialidad</h5>
        <div id="barChartContainer">
          <canvas id="barChart"></canvas>
        </div>
      </div>
      <div class="chart-box">
        <h5>üéØ Salud por √Årea Empresarial</h5>
        <div id="radarChartContainer">
          <canvas id="radarChart"></canvas>
        </div>
      </div>
    </div>

    <div id="presupuestoSection"></div>
    
    <h3 style="text-align:center;color:#192444;margin:40px 0 20px;">Diagn√≥stico Detallado por Especialidad</h3>
    <div id="especialidadesDetalle"></div>

    <div class="email-box">
      <h3 style="color:#192444;margin-bottom:20px;">¬°Recibe tu informe completo!</h3>
      <p style="font-size:1.1rem;margin-bottom:20px;">Introduce tu email para recibir el informe detallado y tu c√≥digo de activaci√≥n como <strong>Persona de Excelencia del C√≠rculo de Innovaci√≥n Operativa</strong>.</p>
      
      <input type="email" id="emailCliente" class="form-control" placeholder="tu@email.com" style="max-width:400px;margin:15px auto;padding:12px;font-size:1.1rem;border:2px solid #1e4fad;border-radius:8px;">
      
      <button class="btn btn-primary btn-send" onclick="enviarDiagnostico()" id="btnEnviar">
        Quiero recibir mi informe y c√≥digo de activaci√≥n
      </button>
      
      <div id="activationBox" style="display:none;margin-top:20px;">
        <div class="activation-code">C√≥digo de Activaci√≥n:<br><span id="codigoExc"></span></div>
        <div id="emailAviso" style="margin-top:15px;font-weight:600;color:#192444;"></div>
      </div>
    </div>

    <div style="margin-top:50px;padding:35px;background:linear-gradient(135deg, #f0f4ff 0%, #e8f0ff 100%);border-radius:15px;text-align:center;border:3px solid #cfb258;">
      <h3 style="color:#192444;font-weight:700;font-size:1.6rem;margin-bottom:20px;">¬°Has dado un paso clave hacia la excelencia empresarial!</h3>
      <p style="font-size:1.05rem;color:#192444;line-height:1.7;">El equipo de Masesora te felicita por llevar tu empresa al siguiente nivel.</p>
      <div style="margin-top:25px;font-size:1.1rem;font-weight:600;">
        <a href="mailto:info@masesora.com" style="color:#1e4fad;text-decoration:none;margin:0 10px;">info@masesora.com</a> | 
        <a href="https://www.masesora.com" target="_blank" style="color:#1e4fad;text-decoration:none;margin:0 10px;">www.masesora.com</a>
      </div>
    </div>
  </div>
</div>

<script>
// Mapeo de especialidades (10 totales, 2 por √°rea)
const especialidadesMap = {
  'Rentabilidad': [
    { nombre: 'UCI FINANCIERA', descripcion: 'Gesti√≥n de crisis financiera' },
    { nombre: 'NEUROLOG√çA ESTRAT√âGICA', descripcion: 'Planificaci√≥n y visi√≥n' }
  ],
  'Procesos': [
    { nombre: 'UNIDAD DE PROCESOS', descripcion: 'Optimizaci√≥n operativa' },
    { nombre: 'GESTI√ìN CL√çNICA', descripcion: 'Sistemas y control' }
  ],
  'Tiempos': [
    { nombre: 'EXCELENCIA OPERATIVA', descripcion: 'M√°ximo rendimiento' },
    { nombre: 'RESCATE DE PERSONAS', descripcion: 'Retenci√≥n de talento' }
  ],
  'Personas': [
    { nombre: 'PSIQUIATR√çA ORGANIZACIONAL', descripcion: 'Cultura y motivaci√≥n' },
    { nombre: 'TERAPIA DE EXPERIENCIA', descripcion: 'Experiencia del cliente' }
  ],
  'Comunicaci√≥n': [
    { nombre: 'CIRUG√çA DE MARCA', descripcion: 'Identidad y posicionamiento' },
    { nombre: 'CARDIOLOG√çA COMERCIAL', descripcion: 'Ventas y clientes' }
  ]
};

function normalizar(score){ return Math.round(score*100/12); }

function getNivel(score) {
  if (score <= 70) return { nivel: 'CR√çTICO', emoji: 'üî¥', clase: 'critico', color: '#d90033' };
  if (score <= 85) return { nivel: 'RECOMENDADO', emoji: 'üü†', clase: 'recomendado', color: '#fa8128' };
  if (score <= 95) return { nivel: 'OPTIMIZADOR', emoji: 'üü¢', clase: 'optimizador', color: '#21ae52' };
  return { nivel: '√âLITE', emoji: 'üíé', clase: 'elite', color: '#1e4fad' };
}

function calcularPresupuesto(facturacion, especialidadesNecesarias) {
  const umbral = 15000;
  let precioPIE_base, precioPRE_base;
  
  if (facturacion >= umbral) {
    precioPIE_base = 999;
    precioPRE_base = 4500;
  } else {
    precioPIE_base = 399;
    precioPRE_base = 1499;
  }
  
  // Separar por criticidad
  const criticas = especialidadesNecesarias.filter(e => e.nivel.nivel === 'CR√çTICO');
  const recomendadas = especialidadesNecesarias.filter(e => e.nivel.nivel === 'RECOMENDADO');
  
  // Calcular presupuestos con descuento para recomendadas
  let totalPIE = 0;
  let totalPRE = 0;
  
  let desglose = {
    criticas: criticas.map(e => ({
      ...e,
      precioPIE: precioPIE_base,
      precioPRE: precioPRE_base,
      descuento: false
    })),
    recomendadas: recomendadas.map(e => ({
      ...e,
      precioPIE: Math.round(precioPIE_base * 0.5 * 100) / 100,
      precioPRE: Math.round(precioPRE_base * 0.5 * 100) / 100,
      descuento: true
    }))
  };
  
  // Calcular totales
  desglose.criticas.forEach(e => {
    totalPIE += e.precioPIE;
    totalPRE += e.precioPRE;
  });
  
  desglose.recomendadas.forEach(e => {
    totalPIE += e.precioPIE;
    totalPRE += e.precioPRE;
  });
  
  return {
    desglose,
    totalPIE: Math.round(totalPIE * 100) / 100,
    totalPRE: Math.round(totalPRE * 100) / 100,
    especialidadesCriticas: criticas.length,
    especialidadesRecomendadas: recomendadas.length,
    totalEspecialidades: criticas.length + recomendadas.length
  };
}

let barChart, radarChart;
let diagnosticoActual = null;

function generarDiagnostico(){
  const form = document.getElementById("assessmentForm");
  const nombre = document.getElementById("nombreEmpresa").value.trim();
  const facturacion = parseFloat(document.getElementById("facturacion").value) || 0;
  
  if(!nombre){
    alert("Por favor, introduce el nombre de la empresa.");
    return;
  }
  
  if(facturacion <= 0){
    alert("Por favor, introduce la facturaci√≥n mensual.");
    return;
  }
  
  if(!form.checkValidity()){
    alert("Por favor, completa todas las preguntas.");
    return;
  }
  
  const areas = ["Rentabilidad", "Procesos", "Tiempos", "Personas", "Comunicaci√≥n"];
  let areaScores = [];
  let todasEspecialidades = [];
  
  // Calcular score por √°rea y asignar a especialidades
  for(let area of areas){
    let total = 0;
    let prefix = area.toLowerCase();
    if(area === "Tiempos") prefix = "tiempo";
    if(area === "Comunicaci√≥n") prefix = "comunicacion";
    
    for(let i=1; i<=3; i++){
      let fieldName = prefix + i;
      let val = parseInt(form[fieldName]?.value || "1");
      total += val;
    }
    
    let areaScore = normalizar(total);
    areaScores.push(areaScore);
    
    // Asignar el mismo score a las 2 especialidades de esta √°rea
    const especialidadesArea = especialidadesMap[area];
    especialidadesArea.forEach(esp => {
      todasEspecialidades.push({
        nombre: esp.nombre,
        descripcion: esp.descripcion,
        area: area,
        score: areaScore,
        nivel: getNivel(areaScore)
      });
    });
  }
  
  // Calcular presupuesto
  const presupuesto = calcularPresupuesto(facturacion, todasEspecialidades);
  
  diagnosticoActual = {
    nombre: nombre,
    facturacion: facturacion,
    areas: areas,
    areaScores: areaScores,
    especialidades: todasEspecialidades,
    presupuesto: presupuesto,
    timestamp: new Date().toISOString()
  };
  
  // Mostrar resultados
  document.getElementById("assessmentForm").style.display="none";
  document.getElementById("resultSection").style.display="block";
  document.getElementById("dashboardEmpresa").innerHTML="Diagn√≥stico Empresarial de <b>"+nombre+"</b>";
  
  // Gr√°fico de barras por especialidad
  if(barChart) barChart.destroy();
  const ctxBar = document.getElementById('barChart').getContext('2d');
  barChart = new Chart(ctxBar, {
    type: "bar",
    data: {
      labels: todasEspecialidades.map(e => e.nombre),
      datasets: [{
        label: "Salud (%)",
        data: todasEspecialidades.map(e => e.score),
        backgroundColor: todasEspecialidades.map(e => e.nivel.color),
        borderColor: todasEspecialidades.map(e => e.nivel.color),
        borderWidth: 2
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: {
          min: 0,
          max: 100,
          title: {
            display: true,
            text: 'Puntuaci√≥n (%)',
            font: { size: 14, weight: 'bold' },
            color: '#192444'
          },
          ticks: {
            callback: function(value) { return value + '%'; },
            font: { size: 11 }
          }
        },
        y: {
          ticks: {
            font: { size: 10, weight: '600' },
            color: '#192444'
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(25,36,68,0.95)',
          callbacks: {
            label: function(context) {
              return 'Puntuaci√≥n: ' + context.parsed.x + '%';
            }
          }
        }
      }
    }
  });
  
  // Gr√°fico radar por √°reas
  if(radarChart) radarChart.destroy();
  const ctxRadar = document.getElementById('radarChart').getContext('2d');
  radarChart = new Chart(ctxRadar, {
    type: 'radar',
    data: {
      labels: areas,
      datasets: [{
        label: 'Salud Empresarial',
        data: areaScores,
        backgroundColor: 'rgba(30, 79, 173, 0.2)',
        borderColor: '#1e4fad',
        borderWidth: 3,
        pointBackgroundColor: '#1e4fad',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: '#1e4fad',
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        r: {
          min: 0,
          max: 100,
          beginAtZero: true,
          ticks: {
            stepSize: 20,
            font: { size: 11 },
            callback: function(value) { return value + '%'; }
          },
          pointLabels: {
            font: { size: 12, weight: '600' },
            color: '#192444'
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.1)'
          },
          angleLines: {
            color: 'rgba(0, 0, 0, 0.1)'
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(25,36,68,0.95)',
          callbacks: {
            label: function(context) {
              return context.label + ': ' + context.parsed.r + '%';
            }
          }
        }
      }
    }
  });
  
  // Mostrar presupuesto desglosado
  let presupuestoHTML = '<div class="presupuesto-box"><h3>üí∞ Inversi√≥n Recomendada</h3>';
  
  if(presupuesto.desglose.criticas.length > 0) {
    presupuestoHTML += `
      <div class="presupuesto-categoria critico">
        <h4>üî¥ ESPECIALIDADES CR√çTICAS (${presupuesto.desglose.criticas.length})</h4>`;
    
    presupuesto.desglose.criticas.forEach(esp => {
      presupuestoHTML += `
        <div class="especialidad-presupuesto critico">
          <div class="esp-nombre-presupuesto">${esp.nombre} [${esp.score}%]</div>
          <div class="esp-precios">
            <div class="precio-item">PIE: <strong>${esp.precioPIE}‚Ç¨</strong></div>
            <div class="precio-item">PRE: <strong>${esp.precioPRE}‚Ç¨</strong></div>
          </div>
        </div>`;
    });
    
    presupuestoHTML += '</div>';
  }
  
  if(presupuesto.desglose.recomendadas.length > 0) {
    presupuestoHTML += `
      <div class="presupuesto-categoria recomendado">
        <h4>üü† ESPECIALIDADES RECOMENDADAS - 50% DESCUENTO (${presupuesto.desglose.recomendadas.length})</h4>`;
    
    presupuesto.desglose.recomendadas.forEach(esp => {
      presupuestoHTML += `
        <div class="especialidad-presupuesto recomendado">
          <div class="esp-nombre-presupuesto">
            ${esp.nombre} [${esp.score}%]
            <span class="descuento-badge">-50%</span>
          </div>
          <div class="esp-precios">
            <div class="precio-item">PIE: <strong>${esp.precioPIE}‚Ç¨</strong> <span>(antes ${esp.precioPIE * 2}‚Ç¨)</span></div>
            <div class="precio-item">PRE: <strong>${esp.precioPRE}‚Ç¨</strong> <span>(antes ${esp.precioPRE * 2}‚Ç¨)</span></div>
          </div>
        </div>`;
    });
    
    presupuestoHTML += '</div>';
  }
  
  if(presupuesto.totalEspecialidades === 0) {
    presupuestoHTML += '<p style="text-align:center;font-size:1.2rem;color:#21ae52;font-weight:600;">¬°Excelente! Tu empresa est√° en √≥ptimas condiciones. Solo se recomienda optimizaci√≥n continua.</p>';
  }
  
  // A√±adir garant√≠a
  presupuestoHTML += `
    <div class="garantia-box">
      <h4>‚úÖ Garant√≠a de Implementaci√≥n</h4>
      <p class="metodologia">Metodolog√≠a garantizada:</p>
      <ul>
        <li>O el protocolo funciona, o no lo pagas.</li>
        <li>Si no se alcanza el KPI acordado, suspendemos el PRE y ampliamos el servicio sin coste.</li>
        <li>Y si aun as√≠ no funciona, te devolvemos el PRE.</li>
      </ul>
    </div>
  `;
  
  presupuestoHTML += '</div>';
  document.getElementById("presupuestoSection").innerHTML = presupuestoHTML;
  
  // Mostrar detalle de especialidades
  let especialidadesHTML = '';
  todasEspecialidades.forEach(esp => {
    especialidadesHTML += `
      <div class="especialidad-card ${esp.nivel.clase}">
        <div class="especialidad-nombre">${esp.nivel.emoji} ${esp.nombre}</div>
        <div style="color:#666;font-size:0.9rem;margin-bottom:10px;">${esp.descripcion} ‚Ä¢ √Årea: ${esp.area}</div>
        <div>
          <span class="especialidad-score" style="color:${esp.nivel.color};">${esp.score}%</span>
          <span class="especialidad-nivel" style="background:${esp.nivel.color};color:white;">${esp.nivel.nivel}</span>
        </div>
      </div>
    `;
  });
  document.getElementById("especialidadesDetalle").innerHTML = especialidadesHTML;
  
  document.getElementById("resultSection").scrollIntoView({ behavior: 'smooth' });
}

function enviarDiagnostico(){
  const email = document.getElementById("emailCliente").value.trim();
  const btnEnviar = document.getElementById("btnEnviar");
  
  if(!/\S+@\S+\.\S+/.test(email)){
    alert("Por favor, introduce un email v√°lido.");
    return;
  }
  
  btnEnviar.disabled = true;
  btnEnviar.innerHTML = '<span class="spinner"></span> Enviando...';
  
  const codigo = "MAS-" + Math.random().toString(36).substr(2,8).toUpperCase();
  
  const data = {
    timestamp: diagnosticoActual.timestamp,
    nombreEmpresa: diagnosticoActual.nombre,
    facturacion: diagnosticoActual.facturacion,
    email: email,
    codigo: codigo,
    diagnostico: diagnosticoActual
  };
  
  // üî¥ IMPORTANTE: CAMBIA ESTA URL POR LA DE TU GOOGLE APPS SCRIPT
  // Pasos: 1. Ve a Apps Script ‚Üí Implementar ‚Üí Administrar implementaciones
  //        2. Edita (l√°piz) ‚Üí Nueva versi√≥n ‚Üí Implementar
  //        3. Copia la URL que termina en /exec
  //        4. P√©gala aqu√≠ abajo:
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz7StqiPEISqUiRm5MFbG1pFsJ8G5kIKITgx5Y_oJQC5XMLjUm03n6e54PWN4whKrmN3Q/exec";
  
  // Convertir los datos a formato URL encoded
  const formData = new FormData();
  formData.append('timestamp', data.timestamp);
  formData.append('nombreEmpresa', data.nombreEmpresa);
  formData.append('facturacion', data.facturacion);
  formData.append('email', data.email);
  formData.append('codigo', data.codigo);
  formData.append('diagnostico', JSON.stringify(data.diagnostico));
  
  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(result => {
    console.log('Respuesta del servidor:', result);
    
    if(result.status === 'success') {
      document.getElementById("activationBox").style.display="block";
      document.getElementById("codigoExc").innerText=codigo;
      document.getElementById("emailAviso").innerHTML=`‚úÖ ¬°Enviado! Recibir√°s tu informe completo en: <strong>${email}</strong><br>Tu c√≥digo de activaci√≥n: <strong>${codigo}</strong>`;
      
      btnEnviar.innerHTML = '‚úì Enviado correctamente';
      btnEnviar.style.background = '#21ae52';
    } else {
      throw new Error(result.message || 'Error desconocido');
    }
  })
  .catch((error) => {
    console.error("Error completo:", error);
    document.getElementById("activationBox").style.display="block";
    document.getElementById("codigoExc").innerText=codigo;
    document.getElementById("emailAviso").innerHTML=`‚ö†Ô∏è Error al enviar. Tu c√≥digo: <strong>${codigo}</strong><br>Contacta con info@masesora.com con este c√≥digo.`;
    
    btnEnviar.innerHTML = '‚ö†Ô∏è Error - Reintentar';
    btnEnviar.style.background = '#d90033';
    btnEnviar.disabled = false;
  });
}
</script>
</body>
</html>